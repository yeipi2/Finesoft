@* Servicios necesarios para navegación y estado de autenticación *@
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider

@code {
    // Ruta a la que se redirige si ya está autenticado
    [Parameter] public string RedirectTo { get; set; } = "/dashboard";

    // Al inicializar, verifica si el usuario ya está autenticado
    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var isAuth = authState.User.Identity?.IsAuthenticated == true;

        if (isAuth)
        {
            var currentUri = Navigation.ToBaseRelativePath(Navigation.Uri);

            // Evita loop si ya estás en el destino
            var target = RedirectTo.TrimStart('/');
            if (!currentUri.StartsWith(target, StringComparison.OrdinalIgnoreCase))
            {
                // Redirige forzando carga completa
                Navigation.NavigateTo(RedirectTo, forceLoad: true);
            }
        }
    }
}
