@* fs-front/Components/Employees/Form/AccessDataSection.razor *@
@using fs_front.DTO
@using fs_front.Components.Shared

<FormSection Title="Datos de Acceso al Sistema"
             IconClass="bi-person-circle"
             IsComplete="@IsComplete">
    <div class="row g-3">

        @* ── Email ── *@
        <div class="col-md-6">
            <label for="Email" class="form-label small fw-bold">
                Email / Usuario <span class="text-danger">*</span>
            </label>
            <InputText id="Email"
                       type="email"
                       class="form-control form-control-sm"
                       placeholder="correo@empresa.com"
                       Value="@Employee.Email"
                       ValueChanged="@(v => { Employee.Email = v; OnChanged?.Invoke(); })"
                       ValueExpression="@(() => Employee.Email)" />
            <small class="text-muted">Usuario de acceso al sistema</small>
            <ValidationMessage For="@(() => Employee.Email)" />
        </div>

        @* ── Contraseña (solo en crear) ── *@
        @if (!IsEditMode)
        {
            <div class="col-md-6">
                <label for="Password" class="form-label small fw-bold">
                    Contraseña <span class="text-danger">*</span>
                </label>
                <div class="input-group input-group-sm">
                    <InputText id="Password"
                               type="@(_showPassword ? "text" : "password")"
                               class="form-control"
                               placeholder="Mínimo 8 caracteres"
                               Value="@Employee.Password"
                               ValueChanged="@(v => { Employee.Password = v; OnChanged?.Invoke(); })"
                               ValueExpression="@(() => Employee.Password)" />
                    <button class="btn btn-outline-secondary"
                            type="button"
                            @onclick="TogglePassword"
                            tabindex="-1">
                        <i class="bi @(_showPassword ? "bi-eye-slash" : "bi-eye")"></i>
                    </button>
                </div>
                <small class="text-muted d-block mt-1">
                    Debe contener: mínimo 8 caracteres, una mayúscula, una minúscula, un número y un carácter especial
                </small>
                <ValidationMessage For="@(() => Employee.Password)" />
            </div>
        }

        @* ── Rol ── *@
        <div class="col-md-6">
            <label for="RoleName" class="form-label small fw-bold">
                Rol en el Sistema <span class="text-danger">*</span>
            </label>
            <InputSelect id="RoleName"
                         class="form-select form-select-sm"
                         Value="@Employee.RoleName"
                         ValueChanged="@((string v) => { Employee.RoleName = v; OnChanged?.Invoke(); })"
                         ValueExpression="@(() => Employee.RoleName)">
                <option value="">-- Seleccionar Rol --</option>
                @foreach (var role in Roles)
                {
                    <option value="@role">@role</option>
                }
            </InputSelect>
            <ValidationMessage For="@(() => Employee.RoleName)" />
        </div>

    </div>
</FormSection>

@code {
    [Parameter] public EmployeeDto Employee { get; set; } = new();
    [Parameter] public bool IsEditMode { get; set; }
    [Parameter] public bool IsComplete { get; set; }
    [Parameter] public List<string> Roles { get; set; } = new();
    [Parameter] public Action? OnChanged { get; set; }

    private bool _showPassword = false;
    private void TogglePassword() => _showPassword = !_showPassword;
}