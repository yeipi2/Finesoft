@using fs_front.DTO
@using fs_front.Components.Employees.Shared

<FsDataTable TItem="EmployeeDto"
             Title="Empleados"
             Subtitle="Gestión del personal de la empresa"
             Items="Items"
             IsLoading="IsLoading"
             ColSpan="6"
             EmptyTitle="@EmptyTitle"
             EmptySubtitle="Prueba con otra búsqueda.">
    <Header>
        <FsSortHeader Text="Nombre" Field="name" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" ThClass="ps-4" />
        <FsSortHeader Text="Email" Field="email" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" />
        <FsSortHeader Text="Puesto" Field="position" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" />
        <FsSortHeader Text="Departamento" Field="department" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" />
        <FsSortHeader Text="Rol" Field="role" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" />
        <FsSortHeader Text="Estado" Field="status" ActiveField="@SortField" Direction="@SortDir" SortChanged="SortChanged" />
    <th class="text-center">Acciones</th>
    </Header>
    <RowTemplate Context="employee">
        <tr>
            <td class="fw-bold ps-4">
                @employee.FullName
                <div class="text-muted small">@employee.Phone</div>
            </td>
            <td>@employee.Email</td>
            <td>@employee.Position</td>
            <td>@employee.Department</td>
            <td>
                <span class="badge bg-info text-dark">@employee.RoleName</span>
            </td>
            <td>
                <EmployeeStatusBadge IsActive="employee.IsActive" />
            </td>
            <td class="text-center">
                @if (CanEdit)
                {
                    <button @onclick="@(() => OnEditClicked.InvokeAsync(employee.Id))"
                            class="btn btn-sm btn-outline-primary me-1" title="Editar">
                        <i class="bi bi-pencil-fill"></i>
                    </button>
                    <button @onclick="@(() => OnToggleStatusClicked.InvokeAsync(employee))"
                            class="btn btn-sm @(employee.IsActive ? "btn-outline-warning" : "btn-outline-success")"
                            title="Cambiar estado">
                        <i class="bi @(employee.IsActive ? "bi-person-x-fill" : "bi-person-check-fill")"></i>
                    </button>
                }
            </td>
        </tr>
    </RowTemplate>
</FsDataTable>

@code {
    [Parameter] public IEnumerable<EmployeeDto> Items { get; set; } = Enumerable.Empty<EmployeeDto>();
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public bool CanEdit { get; set; }
    [Parameter] public string SortField { get; set; } = "name";
    [Parameter] public FsSortHeader.SortDirection SortDir { get; set; }
    [Parameter] public string EmptyTitle { get; set; } = "No hay empleados registrados";
    [Parameter] public EventCallback<(string, FsSortHeader.SortDirection)> SortChanged { get; set; }
    [Parameter] public EventCallback<int?> OnEditClicked { get; set; }
    [Parameter] public EventCallback<EmployeeDto> OnToggleStatusClicked { get; set; }
}