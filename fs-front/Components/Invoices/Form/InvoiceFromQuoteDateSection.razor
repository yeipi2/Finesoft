@using fs_front.DTO
@using fs_front.Components.Shared

<FormSection Title="Datos de la Factura"
             IconClass="bi-calendar3"
             IsComplete="@IsComplete">

    <div class="row g-3">

        <div class="col-md-6">
            <label class="form-label small fw-bold">
                Fecha de Factura <span class="text-danger">*</span>
            </label>
            <InputDate class="form-control form-control-sm"
                       @bind-Value="Dto.InvoiceDate"
                       @bind-Value:after="NotifyChanged" />
        </div>

        <div class="col-md-6">
            <label class="form-label small fw-bold">Fecha de Vencimiento</label>
            <InputDate class="form-control form-control-sm"
                       @bind-Value="Dto.DueDate" />
        </div>

        <InvoicePaymentTermsSection PaymentType="@(Dto.PaymentType ?? "PPD")"
                                    PaymentMethod="@(Dto.PaymentMethod ?? string.Empty)"
                                    PaymentTypeChanged="HandlePaymentTypeChanged"
                                    PaymentMethodChanged="HandlePaymentMethodChanged" />

    </div>

</FormSection>

@code {
    [Parameter] public CreateInvoiceFromQuoteDto Dto       { get; set; } = new();
    [Parameter] public bool                      IsComplete { get; set; }
    [Parameter] public EventCallback             OnChanged  { get; set; }

    private async Task HandlePaymentTypeChanged(string paymentType)
    {
        Dto.PaymentType = paymentType;
        if (!string.Equals(paymentType, "PUE", StringComparison.OrdinalIgnoreCase))
            Dto.PaymentMethod = string.Empty;

        await OnChanged.InvokeAsync();
    }

    private async Task HandlePaymentMethodChanged(string paymentMethod)
    {
        Dto.PaymentMethod = paymentMethod;
        await OnChanged.InvokeAsync();
    }

    private Task NotifyChanged() => OnChanged.InvokeAsync();
}
