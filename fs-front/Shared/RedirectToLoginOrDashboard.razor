@using System.Security.Claims
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthProvider

@code {
    protected override async Task OnInitializedAsync()
    {
        var state = await AuthProvider.GetAuthenticationStateAsync();
        var user = state.User;

        // No autenticado -> login
        if (user.Identity?.IsAuthenticated != true)
        {
            Nav.NavigateTo("/iniciar-sesion", true);
            return;
        }

        // Leer rol (si existe)
        var role = user.FindFirst(ClaimTypes.Role)?.Value;

        // Sin rol -> pending
        if (string.IsNullOrWhiteSpace(role))
        {
            Nav.NavigateTo("/pending", true);
            return;
        }

        // Technician -> pending (por ahora)
        if (role == "Technician")
        {
            Nav.NavigateTo("/pending", true);
            return;
        }

        // Admin/User -> dashboard
        Nav.NavigateTo("/dashboard", true);
    }
}